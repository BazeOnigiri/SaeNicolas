<UserControl x:Class="Nicolas.UCs.UCModifierCommande"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tête avec les informations de la commande -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- État initial -->
            <Border Grid.Column="0" BorderBrush="#DDDDDD" BorderThickness="1" Padding="10" Background="#F9F9F9" Margin="0,0,5,0">
                <StackPanel>
                    <TextBlock Text="État initial" FontWeight="Bold" Margin="0,0,0,5"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                            <TextBlock Text="N° " FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding NumeroCommande}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,20,0">
                            <TextBlock Text="Date : " FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding DateCommande, StringFormat='{}{0:dd/MM/yyyy}'}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                            <TextBlock Text="Total : " FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding PrixTotal, StringFormat='{}{0:N2} €'}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- État après modifications -->
            <Border Grid.Column="1" BorderBrush="#E3F2FD" BorderThickness="1" Padding="10" Background="#F5F9FF" Margin="5,0,0,0">
                <StackPanel>
                    <TextBlock Text="Après modifications" FontWeight="Bold" Margin="0,0,0,5"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,20,0">
                            <TextBlock Text="Nouveau total : " FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding NouveauTotal, StringFormat='{}{0:N2} €'}" Foreground="#1976D2"/>
                        </StackPanel>
                        <TextBlock Grid.Column="1" Text="{Binding DifferenceMessage}" Foreground="#1976D2" 
                                   VerticalAlignment="Center"/>
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Zone principale avec les deux DataGrids -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Demandes associées à la commande -->
            <DockPanel Grid.Column="0" Margin="0,0,5,0">
                <TextBlock DockPanel.Dock="Top" Text="Demandes associées" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <DataGrid x:Name="dgDemandesAssociees" 
                         ItemsSource="{Binding DemandesAssociees}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="N°" Binding="{Binding NumeroDemande}" Width="50"/>
                        <DataGridTextColumn Header="Vin" Binding="{Binding NomVin}" Width="*"/>
                        <DataGridTextColumn Header="Qté" Binding="{Binding QuantiteDemande}" Width="50"/>
                        <DataGridTextColumn Header="Prix" Binding="{Binding PrixVin, StringFormat='{}{0:N2} €'}" Width="70"/>
                        <DataGridTextColumn Header="Date" Binding="{Binding DateDemande}" Width="80"/>
                        <DataGridTemplateColumn Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="×" Click="BtnRetirerDemande_Click" 
                                            FontWeight="Bold"
                                            Width="25" Height="25"
                                            ToolTip="Retirer"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>

            <!-- Liste de toutes les demandes -->
            <DockPanel Grid.Column="1" Margin="5,0,0,0">
                <TextBlock DockPanel.Dock="Top" Text="Demandes disponibles" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <DataGrid x:Name="dgToutesDemandes"
                         ItemsSource="{Binding ToutesLesDemandes}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         VerticalScrollBarVisibility="Auto">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="N°" Binding="{Binding NumeroDemande}" Width="50"/>
                        <DataGridTextColumn Header="Vin" Binding="{Binding NomVin}" Width="*"/>
                        <DataGridTextColumn Header="Qté" Binding="{Binding QuantiteDemande}" Width="50"/>
                        <DataGridTextColumn Header="Prix" Binding="{Binding PrixVin, StringFormat='{}{0:N2} €'}" Width="70"/>
                        <DataGridTextColumn Header="Date" Binding="{Binding DateDemande}" Width="80"/>
                        <DataGridTemplateColumn Width="60">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="+" Click="BtnAjouterDemande_Click"
                                            FontWeight="Bold"
                                            Width="25" Height="25"
                                            ToolTip="Ajouter"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Grid>

        <!-- Boutons d'action -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Valider" Click="BtnValider_Click" Width="80" Margin="5,0"/>
            <Button Content="Supprimer" Click="BtnSupprimer_Click" Width="80" Margin="5,0"/>
            <Button Content="Retour" Click="BtnRetour_Click" Width="80" Margin="5,0,0,0"/>
        </StackPanel>
    </Grid>
</UserControl>